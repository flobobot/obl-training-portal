<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cocktail Card</title>
  <link rel="stylesheet" href="../style.css" />
</head>
<body class="cocktail-card">
  <div class="card">
    <h1 id="title">Loading...</h1>
    <div id="ingredients" class="card-section"></div>
    <div id="method" class="card-section"></div>
    <div id="glassware" class="card-section"></div>
    <div id="garnish" class="card-section"></div>
    <div id="pro_tip" class="card-section"></div>
    <div id="did_you_know" class="card-section"></div>
  </div>

  <footer class="footer-nav">
    <a href="../cocktails/index.html">← Back to Cocktails Index</a>
  </footer>

  <script>
    function slugify(text) {
      return text
        .toString()
        .toLowerCase()
        .replace(/[’'"]/g, '')       // remove apostrophes and quotes
        .replace(/[^\w\s-]/g, '')    // remove non-word characters
        .trim()
        .replace(/\s+/g, '-')        // replace spaces with -
    }

    async function loadCocktail() {
      const params = new URLSearchParams(window.location.search);
      const slug = decodeURIComponent(params.get("slug") || "").toLowerCase();

      try {
        const response = await fetch("../data/cocktail_data_backup.json");
        const cocktails = await response.json();

        const cocktail = cocktails.find(c => slugify(c.title) === slug);
        if (!cocktail) {
          document.body.innerHTML = "<p style='text-align: center;'>Cocktail not found.</p>";
          return;
        }

        document.getElementById("title").textContent = cocktail.title;

        const sections = [
          { id: "ingredients", label: "Ingredients", content: Array.isArray(cocktail.ingredients) ? cocktail.ingredients.join("<br>") : cocktail.ingredients },
          { id: "method", label: "Method", content: cocktail.method },
          { id: "glassware", label: "Glassware", content: cocktail.glassware },
          { id: "garnish", label: "Garnish", content: cocktail.garnish },
          { id: "pro_tip", label: "Pro Tip", content: cocktail.pro_tip },
          { id: "did_you_know", label: "Did You Know?", content: cocktail.did_you_know }
        ];

        sections.forEach(({ id, label, content }) => {
          if (content) {
            const el = document.getElementById(id);
            el.innerHTML = `<h2>${label}</h2><p>${content}</p>`;
          }
        });

      } catch (err) {
        document.body.innerHTML = "<p style='text-align: center;'>Failed to load cocktail data.</p>";
      }
    }

    window.onload = loadCocktail;
  </script>
</body>
</html>