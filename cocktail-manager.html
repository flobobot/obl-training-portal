<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cocktail Card Manager v4</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 2rem;
      background: #f5f5f5;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    input[type="text"] {
      padding: 0.4rem;
      font-size: 1rem;
      margin: 1rem;
      width: 200px;
    }
    button {
      margin: 0.25rem;
      padding: 0.3rem 0.6rem;
      font-size: 0.9rem;
    }
    .grid {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
    }
    .card {
      background: white;
      border-radius: 10px;
      padding: 1rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      width: 160px;
    }
    .card h3 {
      font-size: 1rem;
      margin: 0.5rem 0;
    }
    .card p {
      font-size: 0.85rem;
      margin: 0;
      color: gray;
    }
    .popup {
      display: none;
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 2rem;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      z-index: 999;
      width: 500px;
    }
    .popup input, .popup textarea, .popup select {
      width: 100%;
      margin-bottom: 0.5rem;
      padding: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>Cocktail Card Manager v4</h1>
  <input type="text" id="search" placeholder="Search cocktails..." />
  <button onclick="openEditor()">+ Add New Cocktail</button>
  <div class="grid" id="cocktailGrid"></div>

  <div class="popup" id="popup">
    <h2>Edit Cocktail</h2>
    <input id="title" placeholder="Cocktail Name"/>
    <textarea id="ingredients" placeholder="Ingredients"></textarea>
    <textarea id="method" placeholder="Method"></textarea>
    <input id="glassware" placeholder="Glassware"/>
    <input id="garnish" placeholder="Garnish"/>
    <input id="proTip" placeholder="Pro Tip (optional)"/>
    <input id="didYouKnow" placeholder="Did You Know? (optional)"/>
    <select id="tag">
      <option value="Classic">Classic</option>
      <option value="House Riff">House Riff</option>
      <option value="Non-Alcoholic">Non-Alcoholic</option>
      <option value="Uncategorised">Uncategorised</option>
    </select>
    <br/>
    <button onclick="saveEdit()">Save</button>
    <button onclick="downloadJSON()">Download JSON</button>
    <button onclick="closePopup()">Cancel</button>
  </div>

  <script>
    let cocktails = [];
    let editingIndex = null;

    function renderGrid(data) {
      const grid = document.getElementById('cocktailGrid');
      grid.innerHTML = '';
      data.forEach((c, i) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <h3>${c.title || 'Untitled'}</h3>
          <p>${c.tag || 'Uncategorised'}</p>
          <button onclick="editCocktail(${i})">Edit</button>
          <button onclick="deleteCocktail(${i})">Delete</button>
        `;
        grid.appendChild(card);
      });
    }

    function fetchData() {
      fetch('/data/cocktail_data_backup.json')
        .then(res => res.json())
        .then(data => {
          cocktails = data;
          renderGrid(cocktails);
        });
    }

    function searchCocktails() {
      const term = document.getElementById('search').value.toLowerCase();
      const filtered = cocktails.filter(c => (c.title || '').toLowerCase().includes(term));
      renderGrid(filtered);
    }

    function openEditor() {
      editingIndex = null;
      ['title','ingredients','method','glassware','garnish','proTip','didYouKnow'].forEach(id => {
        document.getElementById(id).value = '';
      });
      document.getElementById('tag').value = 'Uncategorised';
      document.getElementById('popup').style.display = 'block';
    }

    function editCocktail(i) {
      editingIndex = i;
      const c = cocktails[i];
      document.getElementById('title').value = c.title || '';
      document.getElementById('ingredients').value = c.ingredients || '';
      document.getElementById('method').value = c.method || '';
      document.getElementById('glassware').value = c.glassware || '';
      document.getElementById('garnish').value = c.garnish || '';
      document.getElementById('proTip').value = c.proTip || '';
      document.getElementById('didYouKnow').value = c.didYouKnow || '';
      document.getElementById('tag').value = c.tag || 'Uncategorised';
      document.getElementById('popup').style.display = 'block';
    }

    function deleteCocktail(i) {
      if (confirm("Delete this cocktail?")) {
        cocktails.splice(i, 1);
        renderGrid(cocktails);
      }
    }

    function saveEdit() {
      const c = {
        title: document.getElementById('title').value,
        ingredients: document.getElementById('ingredients').value,
        method: document.getElementById('method').value,
        glassware: document.getElementById('glassware').value,
        garnish: document.getElementById('garnish').value,
        proTip: document.getElementById('proTip').value,
        didYouKnow: document.getElementById('didYouKnow').value,
        tag: document.getElementById('tag').value
      };
      if (editingIndex === null) {
        cocktails.push(c);
      } else {
        cocktails[editingIndex] = c;
      }
      closePopup();
      renderGrid(cocktails);
    }

    function closePopup() {
      document.getElementById('popup').style.display = 'none';
    }

    function downloadJSON() {
      const blob = new Blob([JSON.stringify(cocktails, null, 2)], {type: "application/json"});
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "cocktail_data_backup.json";
      link.click();
    }

    document.getElementById('search').addEventListener('input', searchCocktails);
    fetchData();
  </script>
</body>
</html>