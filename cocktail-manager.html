<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cocktail Card Manager v4</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f9f9f9;
      margin: 2rem;
    }
    h1 {
      text-align: center;
      font-size: 1.8rem;
    }
    .controls {
      text-align: center;
      margin-bottom: 1rem;
    }
    input[type="text"] {
      padding: 0.5rem;
      margin-right: 0.5rem;
      width: 250px;
    }
    button {
      padding: 0.5rem 1rem;
    }
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      padding: 1rem;
      text-align: center;
    }
    .card h3 {
      margin: 0;
      font-size: 1rem;
    }
    .card small {
      color: gray;
      display: block;
      margin: 0.5rem 0;
    }
    .card button {
      margin: 0.2rem;
    }
  </style>
</head>
<body>

  <h1>Cocktail Card Manager v4</h1>

  <div class="controls">
    <input type="text" id="searchInput" placeholder="Search cocktails..." oninput="renderCocktails()"/>
    <button onclick="addCocktail()">+ Add New Cocktail</button>
  </div>

  <div class="card-grid" id="cocktailGrid">Loading...</div>

  <script>
    const grid = document.getElementById('cocktailGrid');
    const searchInput = document.getElementById('searchInput');
    let cocktails = [];

    async function fetchData() {
      try {
        const res = await fetch('data/cocktail_data_backup.json');
        cocktails = await res.json();
        renderCocktails();
      } catch (err) {
        grid.innerHTML = '<p style="color:red;">Failed to load cocktail data.</p>';
      }
    }

    function renderCocktails() {
      const query = searchInput.value.toLowerCase();
      const filtered = cocktails.filter(c => c.name.toLowerCase().includes(query));
      grid.innerHTML = '';
      filtered.forEach((cocktail, index) => {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
          <h3>${cocktail.name || 'Untitled'}</h3>
          <small>${cocktail.tag || 'Uncategorised'}</small>
          <button onclick="editCocktail(${index})">Edit</button>
          <button onclick="deleteCocktail(${index})">Delete</button>
        `;
        grid.appendChild(div);
      });
    }

    function editCocktail(index) {
      const c = cocktails[index];
      const fields = ['name', 'ingredients', 'method', 'glass', 'garnish', 'proTip', 'didYouKnow', 'tag'];
      let form = fields.map(f => `
        <label>${f.charAt(0).toUpperCase() + f.slice(1)}:<br/>
          <textarea rows="2" style="width:100%" id="edit-${f}">${c[f] || ''}</textarea>
        </label>
      `).join('<br/>');
      const modal = document.createElement('div');
      modal.style.position = 'fixed';
      modal.style.top = '0'; modal.style.left = '0';
      modal.style.width = '100%'; modal.style.height = '100%';
      modal.style.background = 'rgba(0,0,0,0.3)';
      modal.style.display = 'flex'; modal.style.alignItems = 'center'; modal.style.justifyContent = 'center';
      modal.innerHTML = `
        <div style="background:white; padding:1rem; border-radius:12px; width:90%; max-width:600px;">
          <h2>Edit Cocktail</h2>
          ${form}
          <br/>
          <button onclick="saveEdit(${index})">Save</button>
          <button onclick="document.body.removeChild(this.parentElement.parentElement)">Cancel</button>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function saveEdit(index) {
      const fields = ['name', 'ingredients', 'method', 'glass', 'garnish', 'proTip', 'didYouKnow', 'tag'];
      fields.forEach(f => {
        cocktails[index][f] = document.getElementById(`edit-${f}`).value.trim();
      });
      downloadJSON();
      document.body.querySelector('div[style*="position: fixed"]').remove();
      renderCocktails();
    }

    function addCocktail() {
      cocktails.push({ name: '', tag: 'Uncategorised' });
      renderCocktails();
    }

    function deleteCocktail(index) {
      if (confirm("Are you sure you want to delete this cocktail?")) {
        cocktails.splice(index, 1);
        renderCocktails();
      }
    }

    function downloadJSON() {
      const blob = new Blob([JSON.stringify(cocktails, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'cocktail_data_backup.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    fetchData();
  </script>

</body>
</html>