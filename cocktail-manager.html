<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cocktail Card Manager v4</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 2rem;
      text-align: center;
    }
    h1 {
      font-size: 2rem;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 2rem;
    }
    .card {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 1rem;
    }
    .card h3 {
      margin: 0.5rem 0;
    }
    .tag {
      font-size: 0.8rem;
      color: #555;
    }
    button {
      margin: 0.25rem;
      padding: 0.25rem 0.5rem;
      font-size: 0.85rem;
    }
    #editor {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      display: none;
      z-index: 10;
    }
    #editor textarea, #editor input, #editor select {
      width: 100%;
      margin-bottom: 0.5rem;
      padding: 0.5rem;
    }
    #overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.3);
      display: none;
      z-index: 9;
    }
  </style>
</head>
<body>
  <h1>Cocktail Card Manager v4</h1>
  <input id="search" type="text" placeholder="Search cocktails..." />
  <button onclick="openEditor()">+ Add New Cocktail</button>
  <div class="grid" id="cocktailGrid"></div>

  <div id="overlay" onclick="closeEditor()"></div>
  <div id="editor">
    <h2>Edit Cocktail</h2>
    <input id="name" placeholder="Name" />
    <textarea id="ingredients" placeholder="Ingredients"></textarea>
    <textarea id="method" placeholder="Method"></textarea>
    <input id="glass" placeholder="Glassware" />
    <input id="garnish" placeholder="Garnish" />
    <textarea id="protip" placeholder="Pro Tip (optional)"></textarea>
    <textarea id="didyouknow" placeholder="Did You Know? (optional)"></textarea>
    <select id="tag">
      <option>Classic</option>
      <option>House Riff</option>
      <option>Non-Alcoholic</option>
      <option>Uncategorised</option>
    </select>
    <br />
    <button onclick="saveCocktail()">Save</button>
    <button onclick="downloadJSON()">Download JSON</button>
    <button onclick="closeEditor()">Cancel</button>
  </div>

  <script>
    let cocktails = [];
    let editingIndex = -1;

    async function loadData() {
      const res = await fetch("/data/cocktail_data_backup.json");
      cocktails = await res.json();
      displayCocktails();
    }

    function displayCocktails() {
      const grid = document.getElementById("cocktailGrid");
      const search = document.getElementById("search").value.toLowerCase();
      grid.innerHTML = "";
      cocktails.forEach((c, i) => {
        const name = c.name || "Untitled";
        const tag = c.tag || "Uncategorised";
        if (!name.toLowerCase().includes(search)) return;

        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <strong>${name}</strong><br />
          <span class="tag">${tag}</span><br/>
          <button onclick="editCocktail(${i})">Edit</button>
          <button onclick="deleteCocktail(${i})">Delete</button>
        `;
        grid.appendChild(div);
      });
    }

    function openEditor() {
      editingIndex = -1;
      document.getElementById("editor").style.display = "block";
      document.getElementById("overlay").style.display = "block";
      ["name", "ingredients", "method", "glass", "garnish", "protip", "didyouknow"].forEach(id => document.getElementById(id).value = "");
      document.getElementById("tag").value = "Uncategorised";
    }

    function closeEditor() {
      document.getElementById("editor").style.display = "none";
      document.getElementById("overlay").style.display = "none";
    }

    function editCocktail(i) {
      editingIndex = i;
      const c = cocktails[i];
      document.getElementById("editor").style.display = "block";
      document.getElementById("overlay").style.display = "block";
      document.getElementById("name").value = c.name || "";
      document.getElementById("ingredients").value = c.ingredients || "";
      document.getElementById("method").value = c.method || "";
      document.getElementById("glass").value = c.glass || "";
      document.getElementById("garnish").value = c.garnish || "";
      document.getElementById("protip").value = c.protip || "";
      document.getElementById("didyouknow").value = c.didyouknow || "";
      document.getElementById("tag").value = c.tag || "Uncategorised";
    }

    function saveCocktail() {
      const cocktail = {
        name: document.getElementById("name").value.trim(),
        ingredients: document.getElementById("ingredients").value.trim(),
        method: document.getElementById("method").value.trim(),
        glass: document.getElementById("glass").value.trim(),
        garnish: document.getElementById("garnish").value.trim(),
        protip: document.getElementById("protip").value.trim(),
        didyouknow: document.getElementById("didyouknow").value.trim(),
        tag: document.getElementById("tag").value.trim(),
      };
      if (editingIndex === -1) {
        cocktails.push(cocktail);
      } else {
        cocktails[editingIndex] = cocktail;
      }
      displayCocktails();
      closeEditor();
    }

    function deleteCocktail(i) {
      if (confirm("Delete this cocktail?")) {
        cocktails.splice(i, 1);
        displayCocktails();
      }
    }

    function downloadJSON() {
      const blob = new Blob([JSON.stringify(cocktails, null, 2)], {type: "application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "cocktail_data_backup.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    document.getElementById("search").addEventListener("input", displayCocktails);
    loadData();
  </script>
</body>
</html>