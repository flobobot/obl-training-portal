<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cocktail Card Manager v4</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen;
      background: #f7f7f7;
      text-align: center;
      padding: 2rem;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    .search-bar {
      margin-bottom: 1rem;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .card h3 {
      font-size: 1rem;
      margin: 0;
    }
    .card small {
      color: #555;
    }
    .card button {
      margin-top: 0.5rem;
    }
    .tag {
      font-size: 0.75rem;
      color: #777;
    }
  </style>
</head>
<body>
  <h1>Cocktail Card Manager v4</h1>
  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Search cocktails..." oninput="renderCards()" />
    <button onclick="addNewCocktail()">+ Add New Cocktail</button>
  </div>
  <div id="cardContainer" class="grid"></div>

  <script>
    let cocktails = [];

    async function fetchCocktails() {
      try {
        const res = await fetch('/data/cocktail_data_backup.json');
        cocktails = await res.json();
        renderCards();
      } catch (e) {
        document.getElementById('cardContainer').innerHTML = '<p>Failed to load cocktail data.</p>';
      }
    }

    function renderCards() {
      const container = document.getElementById('cardContainer');
      const query = document.getElementById('searchInput').value.toLowerCase();
      const filtered = cocktails.filter(c => c.name.toLowerCase().includes(query));
      container.innerHTML = filtered.map(c => `
        <div class="card">
          <h3>${c.name || 'Untitled'}</h3>
          <div class="tag">${c.tag || 'Uncategorised'}</div>
          <button onclick='editCocktail("${c.slug}")'>Edit</button>
          <button onclick='deleteCocktail("${c.slug}")'>Delete</button>
        </div>
      `).join('');
    }

    function editCocktail(slug) {
      const cocktail = cocktails.find(c => c.slug === slug);
      const fields = ['name', 'ingredients', 'method', 'glass', 'garnish', 'tip', 'fact', 'tag'];
      const edits = fields.map(f => {
        const val = cocktail[f] || '';
        return `${f}:<br><textarea id="edit-${f}" rows="2" style="width:90%">${val}</textarea><br>`;
      }).join('');
      const modal = document.createElement('div');
      modal.innerHTML = `
        <div style="background:#fff;padding:1rem;border-radius:10px;max-width:600px;margin:2rem auto">
          <h2>Edit ${cocktail.name}</h2>
          ${edits}
          <br>
          <button onclick="saveEdit('${slug}')">Save</button>
          <button onclick="document.body.removeChild(this.parentElement)">Cancel</button>
        </div>`;
      document.body.appendChild(modal);
    }

    function saveEdit(slug) {
      const c = cocktails.find(c => c.slug === slug);
      ['name','ingredients','method','glass','garnish','tip','fact','tag'].forEach(f => {
        c[f] = document.getElementById(`edit-${f}`).value.trim();
      });
      c.slug = c.name.toLowerCase().replace(/[^a-z0-9]+/g, '-');
      downloadJSON();
      document.body.querySelectorAll('div').forEach(d => {
        if (d.innerHTML.includes('Save</button>')) document.body.removeChild(d);
      });
      renderCards();
    }

    function deleteCocktail(slug) {
      if (!confirm("Delete this cocktail?")) return;
      cocktails = cocktails.filter(c => c.slug !== slug);
      downloadJSON();
      renderCards();
    }

    function addNewCocktail() {
      cocktails.unshift({
        name: "",
        slug: "new-cocktail",
        ingredients: "",
        method: "",
        glass: "",
        garnish: "",
        tip: "",
        fact: "",
        tag: "Uncategorised"
      });
      renderCards();
    }

    function downloadJSON() {
      const blob = new Blob([JSON.stringify(cocktails, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "cocktail_data_backup.json";
      a.click();
    }

    fetchCocktails();
  </script>
</body>
</html>